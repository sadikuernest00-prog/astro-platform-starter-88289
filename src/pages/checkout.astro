---
const base = import.meta.env.BASE_URL;
const FORMSPREE_ACTION = "https://formspree.io/f/xzznjkvd";
---

<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout — Amicbridge</title>

  <style>
    :root{--bg:#f7f6f4;--text:#151515;--muted:#6b6b6b;--border:#dedede;--card:#fff;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:24px 40px;display:flex;justify-content:space-between;align-items:center}
    main{max-width:1100px;margin:0 auto;padding:0 40px 70px}
    a{color:var(--text);text-decoration:none}
    h1{margin:16px 0 8px;font-size:34px}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);border:1px solid var(--border);padding:16px;border-radius:12px}
    label{font-size:12px;color:var(--muted);text-transform:uppercase}
    input,textarea{width:100%;padding:12px;border:1px solid var(--border);margin-top:6px;border-radius:10px}
    textarea{min-height:90px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .items{display:flex;flex-direction:column;gap:12px}
    .item{border-top:1px solid var(--border);padding-top:12px;display:grid;grid-template-columns:1fr auto;gap:12px}
    .item:first-child{border-top:0}
    .meta{color:var(--muted);font-size:13px}
    .thumb{width:54px;height:54px;border:1px solid var(--border);border-radius:10px;object-fit:cover}
    .controls{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
    .qty{display:grid;grid-template-columns:36px 44px 36px;border:1px solid var(--border);border-radius:10px}
    .qty button{border:0;background:#fff;font-size:18px;cursor:pointer}
    .qty div{display:flex;align-items:center;justify-content:center;font-weight:900}
    .price{font-weight:900}
    .totals{border-top:1px solid var(--border);padding-top:12px;margin-top:12px}
    .totalsRow{display:flex;justify-content:space-between}
    .btn{padding:14px;border:1px solid var(--text);background:var(--text);color:#fff;font-weight:900;border-radius:12px;width:100%}
    .btn.secondary{background:#fff;color:var(--text);border-color:var(--border)}
    .step{border:1px solid var(--border);padding:14px;border-radius:12px}
    .badge{width:28px;height:28px;border-radius:999px;background:#151515;color:#fff;font-weight:900;display:flex;align-items:center;justify-content:center}
    .stepTitle{display:flex;gap:10px;align-items:center}
    .vippsNumber{font-size:26px;font-weight:900;margin:8px 0}
    .pillrow{display:flex;gap:10px;flex-wrap:wrap}
    .pill{border:1px solid var(--border);padding:10px 12px;font-weight:900;border-radius:12px;background:#fff}
    .error{color:#b42318;font-size:13px;display:none}
    .ok{color:#1a7f37;font-size:13px;display:none}
    .small{font-size:12px;color:var(--muted)}
    @media(max-width:900px){.grid{grid-template-columns:1fr}header,main{padding:18px}}
  </style>
</head>

<body>
<header>
  <a href={`${base}`}>← Back to shop</a>
  <span class="muted">Amicbridge</span>
</header>

<main>
<h1>Checkout</h1>
<div class="muted">Step 1: Pay with Vipps • Step 2: Send order</div>

<div class="grid">
<section class="card">
<h2>Customer details</h2>

<form id="detailsForm" action={FORMSPREE_ACTION} method="POST">
<div class="row2">
<input name="name" placeholder="Full name" required />
<input name="email" type="email" placeholder="Email" required />
</div>
<input name="address" placeholder="Address" required style="margin-top:12px" />
<div class="row2" style="margin-top:12px">
<input name="city" placeholder="City" required />
<input name="zip" placeholder="ZIP" required />
</div>
<textarea name="notes" placeholder="Notes (optional)" style="margin-top:12px"></textarea>

<input type="hidden" id="cartSummary" name="cartSummary" />
<input type="hidden" id="orderTotal" name="orderTotal" />
</form>

<div class="small" style="margin-top:10px">
Pay first in Vipps, then send order.
</div>
</section>

<aside class="card">
<h2>Your order</h2>
<div id="items" class="items"></div>

<div class="totals">
<div class="totalsRow"><span>Subtotal</span><span id="total"></span></div>

<div class="step" style="margin-top:12px">
<div class="stepTitle"><div class="badge">1</div><strong>Pay with Vipps</strong></div>
<div class="meta">Send TOTAL to:</div>
<div class="vippsNumber">92928373</div>
<div class="meta">Message: Your name + product</div>

<div class="pillrow" style="margin-top:10px">
<button class="pill" id="copyNumber">Copy Vipps number</button>
<button class="pill" id="copyTotal">Copy total</button>
</div>

<div class="small" style="margin-top:10px">
Open Vipps app → Send money → Paste number → Paste total
</div>

<img src="/images/vipps-qr.png" alt="Vipps QR"
style="margin-top:12px;width:260px;border:1px solid #dedede;border-radius:12px" />
</div>

<div class="step" style="margin-top:12px">
<div class="stepTitle"><div class="badge">2</div><strong>Send order</strong></div>
<button class="btn secondary" id="sendBtn">Send order details</button>
<p class="error" id="err"></p>
<p class="ok" id="ok"></p>
</div>
</div>
</aside>
</div>
</main>

<script>
const fmt=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"NOK"}).format(n||0);
const cart=JSON.parse(localStorage.getItem("cart")||"[]");
const total=cart.reduce((s,i)=>s+i.price*i.quantity,0);
document.getElementById("total").textContent=fmt(total);
document.getElementById("cartSummary").value=JSON.stringify(cart);
document.getElementById("orderTotal").value=total;

document.getElementById("items").innerHTML=cart.map(i=>`
<div class="item">
<div><strong>${i.name}</strong><div class="meta">${i.size} • ${i.color}</div></div>
<div class="price">${fmt(i.price*i.quantity)}</div>
</div>`).join("");

document.getElementById("copyNumber").onclick=()=>navigator.clipboard.writeText("92928373");
document.getElementById("copyTotal").onclick=()=>navigator.clipboard.writeText(String(total));

document.getElementById("sendBtn").onclick=()=>{
if(!document.getElementById("detailsForm").reportValidity())return;
document.getElementById("detailsForm").submit();
document.getElementById("ok").textContent="Order sent. Please make sure you paid with Vipps.";
document.getElementById("ok").style.display="block";
};
</script>
</body>
</html>
